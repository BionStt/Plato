


EXEC	[plato_sp_SelectUsersPaged2]
		@StartRowIndex = 20,
		@MaximumRows = 10,
		@SqlFirstId = 'SELECT @first_id_out = Id FROM Plato_Users ORDER BY Id DESC',
		@SqlPopulate = 'SELECT * FROM Plato_Users WHERE Id >= @FirstId ORDER BY Id DESC',
		@SqlCount = 'SELECT COUNT(Id) FROM Plato_Users',
		@SqlParams = '@FirstId int, @UserName nvarchar(255), @Email nvarchar(255)'



GO



----------------------------------------------


ALTER  PROCEDURE plato_sp_SelectUsersPaged2
(    
	@StartRowIndex int,
    @MaximumRows int,
	@SqlFirstId nvarchar(4000),
	@SqlPopulate nvarchar(4000),
	@SqlCount nvarchar(4000),
	@SqlParams nvarchar(4000)
	)
AS

DECLARE 
	@first_id int, 
	@startRow int,
	@parms nvarchar(255);

-- Get the first employeeID for our page of records
SET ROWCOUNT @StartRowIndex

SET @parms = '@first_id_out int OUTPUT';  
EXECUTE sp_executesql  @SqlFirstId, @parms, @first_id_out = @first_id OUTPUT

SELECT @first_id AS FirstID

--SELECT @first_id = employeeID FROM employees ORDER BY employeeid

-- set the row count to MaximumRows and 
SET ROWCOUNT @MaximumRows

-- get all records >= @first_id
EXECUTE sp_executesql @SqlPopulate, @SqlParams, 
	@FirstId = @first_id,
	@UserName = '',
	@Email = ''

/*
SELECT e.*
FROM employees e
WHERE employeeid >= @first_id
ORDER BY e.EmployeeID
*/

SET ROWCOUNT 0

GO 