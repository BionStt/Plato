if(typeof jQuery=="undefined")throw new Error("jQuery 3.3.1 or above Required");if(typeof window.$.Plato=="undefined")throw new Error("$.Plato Required");(function(n,t,i){"use strict";var r=t.$.Plato,u=function(){var f="markdown",e=f+"Id",o={autofocus:!1,hideable:!1,savable:!0,width:"inherit",height:"inherit",resize:null,iconlibrary:"fa",language:"en",initialstate:"editor",parser:null,allowedUploadExtensions:["txt","html","zip","png","gif","bmp","jpg","jpeg"],dropZoneOptions:{url:"/api/media/streaming/upload",fallbackClick:!1,autoProcessQueue:!0,autoDiscover:!1,disablePreview:!0,dictDefaultMessage:'Attach files by dragging and dropping here, <a id="#dzUpload" class="dz-clickable" href="#">click to browse<\/a> or paste from the clipboard'},enableDropDataUri:!1,footer:"",fullscreen:{enable:!0,icons:{fullscreenOn:{name:"fullscreenOn",icon:{fa:"fal fa-expand",glyph:"glyphicon glyphicon-fullscreen","fa-3":"icon-resize-full",octicons:"octicon octicon-link-external"}},fullscreenOff:{name:"fullscreenOff",icon:{fa:"fal fa-compress",glyph:"glyphicon glyphicon-fullscreen","fa-3":"icon-resize-small",octicons:"octicon octicon-browser"}}}},buttons:[[{name:"groupFont",css:"btn-group mr-1",data:[{name:"cmdBold",hotkey:"Ctrl+B",title:"Bold",icon:{glyph:"glyphicon glyphicon-bold",fa:"fal fa-bold","fa-3":"icon-bold",octicons:"octicon octicon-bold"},callback:function(n){var i,r,t=n.getSelection(),u=n.getContent();i=t.length===0?n.__localize("strong text"):t.text;u.substr(t.start-2,2)==="**"&&u.substr(t.end,2)==="**"?(n.setSelection(t.start-2,t.end+2),n.replaceSelection(i),r=t.start-2):(n.replaceSelection("**"+i+"**"),r=t.start+2);n.setSelection(r,r+i.length)}},{name:"cmdItalic",title:"Italic",hotkey:"Ctrl+I",icon:{glyph:"glyphicon glyphicon-italic",fa:"fal fa-italic","fa-3":"icon-italic",octicons:"octicon octicon-italic"},callback:function(n){var i,r,t=n.getSelection(),u=n.getContent();i=t.length===0?n.__localize("emphasized text"):t.text;u.substr(t.start-1,1)==="_"&&u.substr(t.end,1)==="_"?(n.setSelection(t.start-1,t.end+1),n.replaceSelection(i),r=t.start-1):(n.replaceSelection("_"+i+"_"),r=t.start+1);n.setSelection(r,r+i.length)}},{name:"cmdHeading",title:"Heading",hotkey:"Ctrl+H",dropdown:{title:"Heading",width:"200px",css:"dropdown-menu-right md-header-dropdown",items:[{name:"cmdHeading1",hotkey:"",text:"<h1>Header 1<\/h1>",value:"#",callback:function(t,i){n.fn.markdown.handlers.insertHeader(t,i)}},{name:"cmdHeading2",text:"<h2>Header 2<\/h2>",value:"##",callback:function(t,i){n.fn.markdown.handlers.insertHeader(t,i)}},{name:"cmdHeading3",text:"<h3>Header 3<\/h3>",value:"###",callback:function(t,i){n.fn.markdown.handlers.insertHeader(t,i)}},{name:"cmdHeading4",text:"<h4>Header 4<\/h4>",value:"####",callback:function(t,i){n.fn.markdown.handlers.insertHeader(t,i)}},{name:"cmdHeading5",text:"<h5>Header 5<\/h5>",value:"#####",callback:function(t,i){n.fn.markdown.handlers.insertHeader(t,i)}},{name:"cmdHeading6",text:"<h6>Header 6<\/h6>",value:"######",callback:function(t,i){n.fn.markdown.handlers.insertHeader(t,i)}}]},icon:{glyph:"glyphicon glyphicon-header",fa:"fal fa-heading","fa-3":"icon-font",octicons:"octicon octicon-text-size"},callback:function(){}}]},{name:"groupInsert",css:"btn-group btn-group-insert mr-1",data:[{name:"cmdLink",title:"Link To URL",hotkey:"Ctrl+L",dropdown:{title:"Link To URL",width:"450px",css:"dropdown-menu-right",items:null,html:'<div class="m-2"><fieldset><input type="link" class="form-control"/><button role="button" type="button" class="btn btn-block btn-primary mt-2"><\/button><\/fieldset><\/div>'},icon:{glyph:"glyphicon glyphicon-link",fa:"fal fa-link","fa-3":"icon-link",octicons:"octicon octicon-link"},callback:function(t,i){var o=t.__localize("https://"),s=t.__localize("Add Link"),r=t.$editor.find("#"+i.attr("data-dropdown-target"));if(r.length!==0){var u=r.find(".dropdown-menu"),f=u.find("input"),e=u.find("button");f.attr("placeholder",o);e.text(s);e.unbind("click").bind("click",function(){var o;t.focus();var r,u,e=t.getSelection(),s=t.getContent(),i=f.val().trim();r=e.length===0?t.__localize("enter link description here"):e.text;i!==null&&i!==""&&i!=="http://"&&i!=="https://"&&(o=n("<div>"+i+"<\/div>").text(),t.replaceSelection("["+r+"]("+o+")"),u=e.start+1,t.setSelection(u,u+r.length),t.$textarea.focus())})}}},{name:"cmdImage",title:"Link To Image",hotkey:"Ctrl+G",dropdown:{title:"Link To Image",width:"450px",css:"dropdown-menu-right",items:null,html:'<div class="m-2"><fieldset><input type="link" class="form-control"/><button role="button" type="button" class="btn btn-block btn-primary mt-2"><\/button><\/fieldset><\/div>'},icon:{glyph:"glyphicon glyphicon-picture",fa:"fal fa-image","fa-3":"icon-picture",octicons:"octicon octicon-file-media"},callback:function(t,i){var o=t.__localize("https://"),s=t.__localize("Add Image"),r=t.$editor.find("#"+i.attr("data-dropdown-target"));if(r.length!==0){var u=r.find(".dropdown-menu"),f=u.find("input"),e=u.find("button");f.attr("placeholder",o);e.text(s);e.unbind("click").bind("click",function(){var r,u,e=t.getSelection(),i,o,s;r=e.length===0?t.__localize("enter image description here"):e.text;i=f.val().trim();o=new RegExp("^((http|https)://|(//))[a-z0-9]","i");i!==null&&i!==""&&i!=="http://"&&o.test(i)&&(s=n("<div>"+i+"<\/div>").text(),t.replaceSelection("!["+r+"]("+s+' "'+t.__localize("enter image title here")+'")'),u=e.start+2,t.setNextTab(t.__localize("enter image title here")),t.setSelection(u,u+r.length),t.$textarea.focus())})}}},{name:"cmdEmoji",title:"Add Emoji",hotkey:"Ctrl+Y",dropdown:{title:"Add Emoji",width:"450px",css:"dropdown-menu-right",items:null,html:'<div class="md-emoji-dropdown"><p class="my-4 text-center"><i class="fal my-4 fa-spinner fa-spin"><\/i><\/p><\/div>'},icon:{glyph:"glyphicon glyphicon-search",fa:"fal fa-smile","fa-3":"icon-search",octicons:"octicon octicon-search"},callback:function(t,i){var u=t.$editor.find("#"+i.attr("data-dropdown-target"));u.length!==0&&(u.data("emojiLoaded")||r.http({url:"api/markdown/emoji/get",method:"GET"}).done(function(i){var f,o,s;if(i.statusCode===200&&i.result){var r=0,h=null,e=null,c=u.find(".md-emoji-dropdown");for(c.empty(),f=n("<ul>",{"class":"nav nav-tabs",role:"tablist"}),r=0;r<i.result.length;r++){var l=i.result[r],a=n("<li>",{title:t.__localize(l.name),"data-toggle":"tooltip","class":r===0?"nav-item ml-2":"nav-item"}),v=n("<a>",{"class":r===0?"nav-link active":"nav-link","data-toggle":"tab","aria-controls":"emoji"+r,href:"#emoji"+r}).text(l.emoji);a.append(v);f.append(a)}for(c.append(f),f.find('[data-toggle="tooltip"]').tooltip({trigger:"hover"}),f.find("a").click(function(t){t.preventDefault();t.stopPropagation();n(this).tab("show")}),o=n("<div>",{"class":"tab-content overflow-auto"}),r=0;r<i.result.length;r++){h=n("<div>",{id:"emoji"+r,"aria-labelledby":"emoji"+r,role:"tabpanel","class":r===0?"tab-pane show active":"tab-pane"});e=i.result[r].emojis;for(s in e)e.hasOwnProperty(s)&&h.append(n("<button>",{type:"button",role:"button",title:s,"class":"dropdown-item d-inline float-left px-1 text-center"}).html(e[s]));o.append(h)}c.append(o);o.find("button").on("click",function(i){var r,u,f;i.preventDefault();u=t.getSelection();r=u.length===0?n(this).attr("title"):n(this).attr("title")+" "+u.text;t.replaceSelection(r);f=u.start+1;t.setSelection(f+r.length,f+r.length);t.$textarea.focus()});u.data("emojiLoaded",!0)}}))}},{name:"cmdVideo",title:"Add Video",hotkey:"Ctrl+Y",dropdown:{title:"Embed Video",width:"450px",css:"dropdown-menu-right",items:null,html:'<div class="m-2"><fieldset><input type="link" class="form-control"/><button role="button" type="button" class="btn btn-block btn-primary mt-2"><\/button><\/fieldset><\/div>'},icon:{glyph:"glyphicon glyphicon-search",fa:"fal fa-film","fa-3":"icon-search",octicons:"octicon octicon-search"},callback:function(t,i){function o(n){if(n.toLowerCase().indexOf("youtu.be")>=0){var t=n.toLowerCase().replace("https://","").replace("http://","").split("/"),i="";t.length>0&&(i=t[t.length-1].replace("?","&"));i!==""&&(n="https://www.youtube.com/watch?v="+i.trim())}return n.trim()}var s=t.__localize("https://www.youtube.com/watch?v=mswPy5bt3TQ"),h=t.__localize("Add Video"),c=t.__localize("You can only embed YouTube or Vimeo videos."),u=t.$editor.find("#"+i.attr("data-dropdown-target"));if(u.length!==0){var f=u.find(".dropdown-menu"),r=f.find("input"),e=f.find("button");r.attr("placeholder",s).focus();e.text(h);e.unbind("click").bind("click",function(i){var f=null,e,h=t.getSelection(),u=o(r.val()||""),s;if((u.toLowerCase().indexOf("youtube.com")>0||u.toLowerCase().indexOf("vimeo.com")>0)&&(f="Description"),u!==""&&f===null){i.stopPropagation();alert(c);r.focus();return}u!==""&&u!=="http://"&&u!=="https://"&&(s=n("<div>"+u+"<\/div>").text(),t.replaceSelection("!["+f+"]("+s+")"),e=h.start+2,t.setSelection(e,e+f.length),t.$textarea.focus())})}}}]},{name:"groupLists",css:"btn-group btn-group-lists mr-1",data:[{name:"cmdList",hotkey:"Ctrl+U",title:"Unordered List",icon:{glyph:"glyphicon glyphicon-list",fa:"fal fa-list","fa-3":"icon-list-ul",octicons:"octicon octicon-list-unordered"},callback:function(t){var r,f,i=t.getSelection(),e=t.getContent(),u;i.length===0?(r=t.__localize("list text here"),t.replaceSelection("- "+r),f=i.start+2):i.text.indexOf("\n")<0?(r=i.text,t.replaceSelection("- "+r),f=i.start+2):(u=[],u=i.text.split("\n"),r=u[0],n.each(u,function(n,t){u[n]="- "+t}),t.replaceSelection("\n\n"+u.join("\n")),f=i.start+4);t.setSelection(f,f+r.length)}},{name:"cmdListO",hotkey:"Ctrl+O",title:"Ordered List",icon:{glyph:"glyphicon glyphicon-th-list",fa:"fal fa-list-ol","fa-3":"icon-list-ol",octicons:"octicon octicon-list-ordered"},callback:function(t){var r,f,i=t.getSelection(),o=t.getContent(),e,u;i.length===0?(r=t.__localize("list text here"),t.replaceSelection("1. "+r),f=i.start+3):i.text.indexOf("\n")<0?(r=i.text,t.replaceSelection("1. "+r),f=i.start+3):(e=1,u=[],u=i.text.split("\n"),r=u[0],n.each(u,function(n,t){u[n]=e+". "+t;e++}),t.replaceSelection("\n\n"+u.join("\n")),f=i.start+5);t.setSelection(f,f+r.length)}}]},{name:"groupBlocks",css:"btn-group btn-group-quotes mr-1",data:[{name:"cmdBlockquote",title:"Blockquote",hotkey:"Ctrl+Q",dropdown:{title:"Blockquote",width:"200px",css:"dropdown-menu-right md-quote-dropdown markdown-body",items:[{name:"cmdBlockquotePrimary",hotkey:"",text:'<blockquote class="dropdown-item primary"><p>Primary<\/p><\/blockquote>',value:"> !primary ",callback:function(t,i){n.fn.markdown.handlers.insertQuote(t,i)}},{name:"cmdBlockquoteDefault",text:'<blockquote class="dropdown-item secondary"><p>Secondary<\/p><\/blockquote>',value:"> !secondary ",callback:function(t,i){n.fn.markdown.handlers.insertQuote(t,i)}},{name:"cmdBlockquoteInfo",text:'<blockquote class="dropdown-item info"><p>Info<\/p><\/blockquote>',value:"> !info ",callback:function(t,i){n.fn.markdown.handlers.insertQuote(t,i)}},{name:"cmdBlockquoteSuccess",text:'<blockquote class="dropdown-item success"><p>Success<\/p><\/blockquote>',value:"> !success ",callback:function(t,i){n.fn.markdown.handlers.insertQuote(t,i)}},{name:"cmdBlockquoteWarning",text:'<blockquote class="dropdown-item warning"><p>Warning<\/p><\/blockquote>',value:"> !warning ",callback:function(t,i){n.fn.markdown.handlers.insertQuote(t,i)}},{name:"cmdBlockquoteDanger",text:'<blockquote class="dropdown-item danger"><p>Danger<\/p><\/blockquote>',value:"> !danger ",callback:function(t,i){n.fn.markdown.handlers.insertQuote(t,i)}}]},icon:{glyph:"glyphicon glyphicon-comment",fa:"fal fa-quote-left","fa-3":"icon-quote-left",octicons:"octicon octicon-quote"},callback:function(){}}]},{name:"groupCode",css:"btn-group btn-group-code mr-1",data:[{name:"cmdCode",hotkey:"Ctrl+K",title:"Code",icon:{glyph:"glyphicon glyphicon-console",fa:"fal fa-code","fa-3":"icon-code",octicons:"octicon octicon-code"},callback:function(n){var i,r,t=n.getSelection(),u=n.getContent();i=t.length===0?n.__localize("code text here"):t.text;u.substr(t.start-4,4)==="```\n"&&u.substr(t.end,4)==="\n```"?(n.setSelection(t.start-4,t.end+4),n.replaceSelection(i),r=t.start-4):u.substr(t.start-1,1)==="`"&&u.substr(t.end,1)==="`"?(n.setSelection(t.start-1,t.end+1),n.replaceSelection(i),r=t.start-1):u.indexOf("\n")>-1?(n.replaceSelection("```\n"+i+"\n```"),r=t.start+4):(n.replaceSelection("`"+i+"`"),r=t.start+1);n.setSelection(r,r+i.length)}}]}]],customIcons:{},additionalButtons:[],reorderButtonGroups:[],hiddenButtons:[],disabledButtons:[],buttonContainer:"#markdownButtons",onShow:function(){},onPreview:function(){},onPreviewEnd:function(){},onSave:function(){},onBlur:function(){},onFocus:function(){},onChange:function(){},onFullscreen:function(){},onFullscreenExit:function(){},onSelect:function(){}},t={init:function(t,i,r){if(n.each(["autofocus","savable","hideable","width","height","resize","iconlibrary","language","footer","fullscreen","hiddenButtons","disabledButtons"],function(n,i){typeof t.data(i)!="undefined"&&(options=typeof options=="object"?options:{},options[i]=t.data(i))}),this.$ns="markdown",this.$element=t,this.$options=t.data(f),this.$editable={el:null,type:null,attrKeys:[],attrValues:[],content:null},this.$oldContent=null,this.$isPreview=!1,this.$isFullscreen=!1,this.$editor=null,this.$textarea=null,this.$handler=[],this.$callback=[],this.$nextTab=[],i)return this[i]!==null&&typeof this[i]!="undefined"?this[i].apply(this,[t,r]):(alert(i+" is not a valid method!"),null);this.showEditor()},_events:{ready:[],write:[],preview:[]},__alterButtons:function(t,i){var r=this.$handler,u=t==="all",f=this;n.each(r,function(n,r){var e=!0;e=u?!1:r.indexOf(t)<0;e===!1&&i(f.$editor.find('button[data-handler="'+r+'"]'))})},__buildButtons:function(t,i,r){for(var v=this.$ns,nt=this.$handler,tt=this.$callback,c,y,l,d,p,g,b,o,s,k,a=0;a<t.length;a++)for(y=t[a],c=0;c<y.length;c++){for(d=y[c].data,p=n("<div />",{"class":y[c].css,role:"group"}),l=0;l<d.length;l++){var u=d[l],it=v+"-"+u.name,rt=this.__getIcon(u),st=u.btnText?u.btnText:"",ut=u.btnClass?u.btnClass:"btn",ht=u.tabIndex?u.tabIndex:"-1",w=typeof u.hotkey!="undefined"?u.hotkey:"",ct=typeof jQuery.hotkeys!="undefined"&&w!==""?" ("+w+")":"",f=typeof u.dropdown!="undefined"?u.dropdown:null,ft=r+"-"+c+"-"+l,e=n('<button type="button" data-toggle="tooltip">');if(e.html(this.__localize(st)).addClass("btn").addClass(ut),ut.match(/btn\-(primary|success|info|warning|danger|link)/)&&e.removeClass("btn-secondary"),e.attr({title:this.__localize(u.title)+ct,tabindex:ht,"data-hotkey":w,"data-provider":v,"data-handler":it}),f&&(e.addClass("dropdown-toggle"),e.attr("data-toggle","dropdown"),e.attr("data-display","static"),e.attr("data-dropdown-target",ft)),u.toggle===!0&&e.attr("data-toggle","button"),rt&&(g=n("<i>"),g.addClass(rt),g.prependTo(e)),f){if(b=n("<div>",{id:ft,"class":"dropdown"}),o=n("<ul>",{"class":"dropdown-menu anim anim-2x anim-scale-in"}),f.css&&o.addClass(f.css),o.css({width:f.width||"250ox"}),f.height&&o.css({"max-height":f.height,"overflow-y":"auto"}),s=null,f.items!==null)for(k=0;k<f.items.length;k++){var h=f.items[k],et=v+"-"+h.name,lt=h.hotkey||"",at=h.value||"",ot=n('<button role="button" type="button" class="dropdown-item">');ot.html(h.text).attr({title:h.tooltip?this.__localize(h.tooltip)+lt:"","data-provider":v,"data-handler":et,"data-hotkey":w,"data-value":at});s=n("<li>");s.append(ot);o.append(s);nt.push(et);tt.push(h.callback)}else s=n("<li>"),s.append(f.html),o.append(s);b.append(e);b.append(o);p.append(b)}else p.append(e);nt.push(it);tt.push(u.callback)}i.append(p)}return i},__setListener:function(){this.$options.resize&&this.$textarea.css("resize",this.$options.resize);this.$textarea.data("markdown",this)},__setEventListeners:function(){this.$textarea.on({focus:n.proxy(this.focus,this),keyup:n.proxy(this.keyup,this),change:n.proxy(this.change,this),select:n.proxy(this.select,this)});if(this.eventSupported("keydown"))this.$textarea.on("keydown",n.proxy(this.keydown,this));if(this.eventSupported("keypress"))this.$textarea.on("keypress",n.proxy(this.keypress,this))},__handle:function(t){var i=n(t.currentTarget),u=this.$handler,f=this.$callback,r=i.attr("data-handler"),e=u.indexOf(r),o=f[e];o(this,i);this.change(this);r.indexOf("cmdSave")<0&&this.$textarea.focus();t.preventDefault()},__localize:function(t){var i=n.fn.markdown.messages,r=this.$options.language;return typeof i!="undefined"&&typeof i[r]!="undefined"&&typeof i[r][t]!="undefined"?i[r][t]:t},__getIcon:function(n){if(typeof n=="object"){var t=this.$options.customIcons[n.name];return typeof t=="undefined"?n.icon?n.icon[this.$options.iconlibrary]:null:t}return n},__parseButtonNameParam:function(n){return typeof n=="string"?n.split(" "):n},setFullscreen:function(t){var r=this.$editor,i=this.$textarea,u=r.closest(".resizable"),e=i.height(),o=u.height(),f;if(t===!0){r.addClass("md-fullscreen-mode");n("body").addClass("md-nooverflow");this.$options.onFullscreen(this);u.css({height:"100%"});i.css({height:"100%"});i.data("height",e);u.data("height",o);i.focus();this.$isPreview===!0&&(f=r.find(".md-preview"),f.find("pre").css({"max-width":r.width()}),f.find("table").css({"max-width":r.width()}))}else{r.removeClass("md-fullscreen-mode");n("body").removeClass("md-nooverflow");this.$options.onFullscreenExit(this);i.focus();i.data("height")&&i.css({height:i.data("height")+"px"});u.data("height")&&u.css({height:u.data("height")+"px"});this.$isPreview===!0&&this.hidePreview().showPreview()}this.$isFullscreen=t},showEditor:function(){var s=this,i,bt=this.$ns,f=this.$element,h=this.$editable,yt=this.$handler,pt=this.$callback,t=this.$options,u=n("<div/>",{"class":"md-editor",click:function(){s.focus()}}),d,g,nt,st,ht,ct,v,y,lt,c,it,at,vt,p;if(this.$editor===null){var e=(new Date).getTime(),w=n("<div/>",{"class":"md-header"}),b=n("<div/>",{"class":"md-header-row"}),rt=n("<div/>",{"class":"md-header-left"}),ut=n("<div/>",{"class":"md-header-right"}),k=n("<ul/>",{"class":"nav nav-tabs",roles:"tablist"}),l=n("<div/>",{"class":"btn-toolbar"}),ft=n("<a/>",{"class":"nav-link active",href:"#writeTab"+e,text:"Write",role:"tab",id:"writeLink"+e,"data-editor-id":e});ft.on("click",function(n){n.preventDefault();s.hidePreview()});d=n("<li/>",{"class":"nav-item"});d.append(ft);g=n("<a/>",{"class":"nav-link",href:"#previewTab"+e,text:"Preview",role:"tab",id:"previewLink"+e,"data-editor-id":e});g.on("click",function(n){n.preventDefault();s.showPreview()});nt=n("<li/>",{"class":"nav-item"});nt.append(g);k.append(d);k.append(nt);var tt=n("<div/>",{"class":"tab-content d-block"}),et=n("<div/>",{"class":"tab-pane position-relative show active md-write",role:"tabpanel",id:"writeTab"+e}),ot=n("<div/>",{"class":"tab-pane md-preview markdown-body",role:"tabpanel",id:"previewTab"+e}),wt=n("<div/>",{"class":"md-dropzone dropzone"}),a=n("<div/>",{"class":"md-footer"}),o=[];if(t.buttons.length>0&&(o=o.concat(t.buttons[0])),t.additionalButtons.length>0&&n.each(t.additionalButtons[0],function(i,r){var u=n.grep(o,function(n){return n.name===r.name});u.length>0?u[0].data=u[0].data.concat(r.data):o.push(t.additionalButtons[0][i])}),t.reorderButtonGroups.length>0&&(o=o.filter(function(n){return t.reorderButtonGroups.indexOf(n.name)>-1}).sort(function(n,i){return t.reorderButtonGroups.indexOf(n.name)<t.reorderButtonGroups.indexOf(i.name)?-1:t.reorderButtonGroups.indexOf(n.name)>t.reorderButtonGroups.indexOf(i.name)?1:0})),o.length>0&&(l=this.__buildButtons([o],l,e)),t.fullscreen.enable){st=this.__localize("Full Screen");l.append('<div class="btn-group"><button class="btn md-control-fullscreen" data-tooltip-position="bottom" title="'+st+'"><i class="'+this.__getIcon(t.fullscreen.icons.fullscreenOn)+'"><\/i><\/button><\/div>').on("click",".md-control-fullscreen",function(n){n.preventDefault();s.setFullscreen(!0)})}if(t.fullscreen.enable&&t.fullscreen!==!1)l.append('<div class="btn-group md-fullscreen-controls"><button class="btn md-exit-fullscreen" title="Exit fullscreen"><i class="'+this.__getIcon(t.fullscreen.icons.fullscreenOff)+'"><\/i><\/button><\/div>').on("click",".md-exit-fullscreen",function(n){n.preventDefault();s.setFullscreen(!1)});rt.append(k);ut.append(l);b.append(rt);b.append(ut);u.append(b);f.is("textarea")?(f.before(u),i=f,et.append(i),ot.append(n("<div/>")),tt.append(et),tt.append(ot),u.append(tt)):(ht=typeof toMarkdown=="function"?toMarkdown(f.html()):f.html(),ct=n.trim(ht),i=n("<textarea/>",{"class":"form-control md-textarea",val:ct}),u.append(i),h.el=f,h.type=f.prop("tagName").toLowerCase(),h.content=f.html(),n(f[0].attributes).each(function(){h.attrKeys.push(this.nodeName);h.attrValues.push(this.nodeValue)}),f.replaceWith(u));v=!1;y="";t.savable&&(v=!0,lt="cmdSave",yt.push(lt),pt.push(t.onSave),a.append('<button type="submit" class="btn btn-primary">'+this.__localize("Save")+"<\/button>"));y=typeof t.footer=="function"?t.footer(this):t.footer;n.trim(y)!==""&&(v=!0,a.append(y));u.append(wt);v&&u.append(a);t.width&&t.width!=="inherit"&&(n.isNumeric(t.width)?(u.css("display","table"),i.css("width",t.width+"px")):u.addClass(t.width));t.height&&t.height!=="inherit"&&(n.isNumeric(t.height)?(c=t.height,w&&(c=Math.max(0,c-w.outerHeight())),a&&(c=Math.max(0,c-a.outerHeight())),i.css("height",c+"px")):u.addClass(t.height));this.$editor=u;this.$textarea=i;this.$editable=h;this.$oldContent=this.getContent();this.__setListener();this.__setEventListeners();this.$editor.attr("id",e);this.$editor.on("click",'[data-provider="markdown"]',n.proxy(this.__handle,this));this.$editor.find("button").tooltip({trigger:"hover"});(this.$element.is(":disabled")||this.$element.is("[readonly]"))&&(this.$editor.addClass("md-editor-disabled"),this.disableButtons("all"));this.eventSupported("keydown")&&typeof jQuery.hotkeys=="object"&&w.find('[data-provider="markdown"]').each(function(){var t=n(this),r=t.attr("data-hotkey");r.toLowerCase()!==""&&i.bind("keydown",r,function(){return t.trigger("click"),!1})});t.initialstate==="preview"?this.showPreview():t.initialstate==="fullscreen"&&t.fullscreen.enable&&this.setFullscreen(!0);this.$textarea.on("keyup keypress paste",function(){n("body").first().attr("data-page-is-dirty")||n("body").first().attr("data-page-is-dirty",!0)})}else this.$editor.show();t.autofocus&&(this.$textarea.focus(),this.$editor.addClass("active"));this.hideButtons(t.hiddenButtons);this.disableButtons(t.disabledButtons);t.dropZoneOptions&&(this.$editor.dropzone?(t.dropZoneOptions.init||(r.defaults&&(it=r.defaults.getCsrfCookieToken(),it===""&&alert("An error occurred. No valid CSRF token could be obtained for the request."),t.dropZoneOptions.url=r.defaults.url+t.dropZoneOptions.url,t.dropZoneOptions.headers={Authorization:"Basic "+r.defaults.apiKey,"X-Csrf-Token":it}),t.dropZoneOptions.init=function(){var n=0,r=t.allowedUploadExtensions;this.on("addedfile",function(t){var f,e,o,s,u,h;if(n=i.prop("selectionStart"),f=t.upload.filename,e=!1,f&&r)for(o=f.split("."),s=o[o.length-1],u=0;u<r.length;u++)h=r[u],s.toLowerCase()===h.toLowerCase()&&(e=!0);return e===!1?(alert("File type is not allowed.\n\nAllowed types are "+r.join(", ")),this.removeFile(t),!1):!0});this.on("drop",function(){n=i.prop("selectionStart")});this.on("success",function(t,r){var f;if(r.statusCode===200&&r&&r.result)for(f=0;f<r.result.length;f++){var u=r.result[f],o=i.val(),e="";u.id>0&&(e=u.isImage?"!["+u.name+"](/media/"+u.id+")":"["+u.name+"](/media/"+u.id+") - "+u.friendlySize,i.val(o.substring(0,n)+e+o.substring(n)),s.setSelection(n+e.length,n+e.length))}});this.on("error",function(n,t){console.log("Error:",t)})}),at=this.$editor.find(".md-dropzone"),vt=new Dropzone(at[0],t.dropZoneOptions),this.$editor.data("dropzone",vt)):console.log("dropZoneOptions was configured, but DropZone was not detected."));this.$editor.on("paste",function(t){var u=(t.clipboardData||t.originalEvent.clipboardData).items,f,r;for(f in u)r=u[f],r.kind==="file"&&(i.focus(),n(this).data("dropzone").addFile(r.getAsFile()))});if(t.enableDropDataUri===!0)this.$editor.on("drop",function(t){var r=i.prop("selectionStart");t.stopPropagation();t.preventDefault();n.each(t.originalEvent.dataTransfer.files,function(n,t){var u=new FileReader;u.onload=function(n){var t=n.type.split("/")[0];return function(u){var f=i.val();t==="image"?i.val(f.substring(0,r)+'\n<img src="'+u.target.result+'" />\n'+f.substring(r)):i.val(f.substring(0,r)+'\n<a href="'+u.target.result+'">Download '+n.name+"<\/a>\n"+f.substring(r))}}(t);u.readAsDataURL(t)})});t.onShow(this);if(this._events)for(p=0;p<this._events.ready.length;p++)this._events.ready[p](this);return this},parseContent:function(n){return n=n||this.$textarea.val(),this.$options.parser?this.$options.parser(n):typeof u=="object"?u.toHTML(n):typeof u=="function"?u(n):n},showPreview:function(){var o,s,h;if(this.$isPreview===!0)return this;var v=this,y=this.$element,p=this.$options,i=this.$editor,e=i.find(".md-dropzone"),u=this.$textarea,c=n("#writeTab"+i.attr("id")),l=n("#writeLink"+i.attr("id")),f=n("#previewTab"+i.attr("id")),a=n("#previewLink"+i.attr("id"));return u.val().trim()===""?(u.focus(),!1):(this.$isPreview=!0,o=0,s=0,u.length>0&&(o=u.outerHeight()),e.length>0&&(s=e.outerHeight()),h=o+s,h>0&&!this.$isFullscreen&&f.css({height:h}),r.http({url:"api/markdown/parse/post",method:"POST",async:!1,data:JSON.stringify({markdown:u.val().trim()})}).done(function(n){if(l.removeClass("active"),c.hide(),a.addClass("active"),f.show(),n.statusCode===200){f.empty().html(n.result);t.$options.onPreview(this,f);if(t._events)for(var i=0;i<t._events.preview.length;i++)t._events.preview[i](f)}}),this.disableButtons("all"),e.hide(),(this.$element.is(":disabled")||this.$element.is("[readonly]"))&&(this.$editor.addClass("md-editor-disabled"),this.disableButtons("all")),this)},hidePreview:function(){var o,r;this.$isPreview=!1;var i=this.$editor,c=this.$textarea,u=i.find(".md-dropzone"),f=n("#writeTab"+i.attr("id")),l=n("#writeLink"+i.attr("id")),e=n("#previewTab"+i.attr("id")),a=n("#previewLink"+i.attr("id")),s=0,h=0;e.length>0&&(s=e.outerHeight());u.length>0&&(h=u.outerHeight());o=s-h;o>0&&!this.$isFullscreen&&c.css({height:o});l.addClass("active");f.show();a.removeClass("active");e.hide();this.enableButtons("all");this.disableButtons(this.$options.disabledButtons);u.show();this.$options.onPreviewEnd(this,f);if(t._events)for(r=0;r<t._events.write.length;r++)t._events.write[r](f);return this},isDirty:function(){return this.$oldContent!==this.getContent()},getContent:function(){return this.$textarea.val()},setContent:function(n){return this.$textarea.val(n),this},findSelection:function(n){var u=this.getContent(),t,i,r;return(t=u.indexOf(n),t>=0&&n.length>0)?(i=this.getSelection(),this.setSelection(t,t+n.length),r=this.getSelection(),this.setSelection(i.start,i.end),r):null},getSelection:function(){var n=this.$textarea[0];return("selectionStart"in n&&function(){var t=n.selectionEnd-n.selectionStart;return{start:n.selectionStart,end:n.selectionEnd,length:t,text:n.value.substr(n.selectionStart,t)}}||function(){return null})()},setSelection:function(n,t){var i=this.$textarea[0];return("selectionStart"in i&&function(){i.selectionStart=n;i.selectionEnd=t;return}||function(){return null})()},replaceSelection:function(n){var t=this.$textarea[0];return("selectionStart"in t&&function(){return t.value=t.value.substr(0,t.selectionStart)+n+t.value.substr(t.selectionEnd,t.value.length),t.selectionStart=t.value.length,this}||function(){return t.value+=n,jQuery(t)})()},getNextTab:function(){if(this.$nextTab.length===0)return null;var t,n=this.$nextTab.shift();return typeof n=="function"?t=n():typeof n=="object"&&n.length>0&&(t=n),t},setNextTab:function(n,t){var r,i;typeof n=="string"?(r=this,this.$nextTab.push(function(){return r.findSelection(n)})):typeof n=="number"&&typeof t=="number"&&(i=this.getSelection(),this.setSelection(n,t),this.$nextTab.push(this.getSelection()),this.setSelection(i.start,i.end));return},enableButtons:function(t){var i=this.__parseButtonNameParam(t),r=this;return n.each(i,function(n){r.__alterButtons(i[n],function(n){n.removeClass("disabled")})}),this},disableButtons:function(t){var i=this.__parseButtonNameParam(t),r=this;return n.each(i,function(n){r.__alterButtons(i[n],function(n){n.addClass("disabled")})}),this},hideButtons:function(t){var i=this.__parseButtonNameParam(t),r=this;return n.each(i,function(n){r.__alterButtons(i[n],function(n){n.addClass("hidden")})}),this},showButtons:function(t){var i=this.__parseButtonNameParam(t),r=this;return n.each(i,function(n){r.__alterButtons(i[n],function(n){n.removeClass("hidden")})}),this},eventSupported:function(n){var t=n in this.$element;return t||(this.$element.setAttribute(n,"return;"),t=typeof this.$element[n]=="function"),t},keyup:function(t){var i=!1,u,c,f,r,s,h;switch(t.keyCode){case 40:case 38:case 16:case 17:case 18:break;case 9:(u=this.getNextTab(),u!==null)?(c=this,setTimeout(function(){c.setSelection(u.start,u.end)},500),i=!0):(f=this.getSelection(),f.start===f.end&&f.end===this.getContent().length?i=!1:(this.setSelection(this.getContent().length,this.getContent().length),i=!0));break;case 13:i=!1;var l=this.getContent().split(""),e=this.getSelection().start,o=-1;for(r=e-2;r>=0;r--)if(l[r]==="\n"){o=r;break}s=l[o+1];s==="-"?this.addBullet(e):n.isNumeric(s)&&(h=this.getBulletNumber(o+1),h&&this.addNumberedBullet(e,h));break;case 27:this.$isFullscreen&&this.setFullscreen(!1);i=!1;break;default:i=!1}i&&(t.stopPropagation(),t.preventDefault());this.$options.onChange(this)},insertContent:function(n,t){var i=this.getContent().slice(0,n),r=this.getContent().slice(n+1);this.setContent(i.concat(t).concat(r))},addBullet:function(n){this.insertContent(n,"- \n");this.setSelection(n+2,n+2)},addNumberedBullet:function(n,t){var r=t+1+". \n",i;this.insertContent(n,r);i=t.toString().length+2;this.setSelection(n+i,n+i)},getBulletNumber:function(t){var i=this.getContent().slice(t).split(".")[0];return n.isNumeric(i)?parseInt(i):null},change:function(){this.$options.onChange(this);return this},select:function(){this.$options.onSelect(this);return this},focus:function(){var t=this.$options,u=t.hideable,r=this.$editor;r.addClass("active");n(i).find(".md-editor").each(function(){if(n(this).attr("id")!==r.attr("id")){var t;(t=n(this).find("textarea").data("markdown"),t===null)&&(t=n(this).find('div[data-provider="markdown-preview"]').data("markdown"));t&&t.blur()}});t.onFocus(this);return this},blur:function(){var u=this.$options,f=u.hideable,i=this.$editor,t=this.$editable;if(i.hasClass("active")||this.$element.parent().length===0){if(i.removeClass("active"),f)if(t.el!==null){var r=n("<"+t.type+"/>"),e=this.getContent(),o=this.parseContent(e);n(t.attrKeys).each(function(n){r.attr(t.attrKeys[n],t.attrValues[n])});r.html(o);i.replaceWith(r)}else i.hide();u.onBlur(this)}return this},ready:function(n,i){return i&&t._events.events.ready.push(i),this},preview:function(n,i){return i&&t._events.preview.push(i),this}};return{init:function(){for(var r,c,i={},u=null,s=null,h=0;h<arguments.length;++h){r=arguments[h];switch(r.constructor){case Object:n.extend(i,r);break;case String:u=r;break;case Function:s=r}}if(this.length>0)return this.each(function(){if(n(this).data(e))n(this).data(f,n.extend({},n(this).data(f),i));else{var r=f+parseInt(Math.random()*100)+(new Date).getTime();n(this).data(e,r);n(this).data(f,n.extend({},o,i))}return t.init(n(this),u,s)});c=n('textarea[data-provide="markdown"]');c.each(function(){var r=n(this),h;if(r.length>0)return r.data(e)?r.data(f,n.extend({},r.data(f),i)):(h=f+parseInt(Math.random()*100)+(new Date).getTime(),r.data(e,h),r.data(f,n.extend({},o,i))),t.init(r,u,s)})}}}(),f;n.fn.extend({markdown:u.init});n.fn.markdown.messages={};n.fn.markdown.handlers={insertQuote:function(t,i){var u,o,r=t.getSelection(),s=t.getContent(),f=i.attr("data-value")||"> ",e;r.length===0?(u=t.__localize("quote here"),t.replaceSelection(f+u),o=r.start+f.length):r.text.indexOf("\n")<0?(u=r.text,t.replaceSelection(f+u),o=r.start+f.length):(e=[],e=r.text.split("\n"),u=e[0],n.each(e,function(n,t){e[n]=f+t}),t.replaceSelection(e.join("\n")),o=r.start+f.length);t.setSelection(o,o+u.length)},insertHeader:function(n,t){var f,e,i=n.getSelection(),o=n.getContent(),r,s,u=t.attr("data-value")||"#";f=i.length===0?n.__localize("heading text"):i.text;(r=u.length+1,o.substr(i.start-r,r)===u+" ")||(r=u.length,o.substr(i.start-r,r)===u)?(n.setSelection(i.start-r,i.end),n.replaceSelection(f),e=i.start-r):i.start>0&&(s=o.substr(i.start-1,1),!!s&&s!=="\n")?(n.replaceSelection(u+" "+f),e=i.start+u.length+1):(n.replaceSelection(u+" "+f),e=i.start+u.length+1);n.setSelection(e,e+f.length)}};f=function(){var t=n(i.activeElement);n(i).find(".md-editor").each(function(){var i=n(this),u=t.closest(".md-editor")[0]===this,r=i.find("textarea").data("markdown")||i.find('div[data-provider="markdown-preview"]').data("markdown");r&&!u&&r.blur()})};n(i).on("click focusin",function(n){f(n)}).ready(function(){n('textarea[data-provide="markdown"]').markdown({onPreview:function(n,t){t.markdownBody()}})})})(jQuery,window,document);